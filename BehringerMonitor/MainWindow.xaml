<Window x:Class="BehringerMonitor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:BehringerMonitor"
        xmlns:viewmodels="clr-namespace:BehringerMonitor.ViewModels"
        xmlns:conveters="clr-namespace:BehringerMonitor.Converters"
        xmlns:rules="clr-namespace:BehringerMonitor.Rules"
        xmlns:models="clr-namespace:BehringerMonitor.Models"
        xmlns:settings="clr-namespace:BehringerMonitor.Settings"
        mc:Ignorable="d"
        Title="Behringer Monitor" Height="700" Width="1000">
  <Window.Resources>
    <conveters:TypeToNameConverter x:Key="TypeToNameConverter"/>
    <DataTemplate DataType="{x:Type rules:RuleSelector}">
      <Border BorderBrush="Black" BorderThickness="1,1,1,1" CornerRadius="8,8,8,8" Padding="3,3,3,3"> 
        <StackPanel Orientation="Horizontal">
          <StackPanel Width="200">
            <ComboBox
                ItemsSource="{x:Static viewmodels:SettingsTabViewModel.BaseRuleTypes}"
                SelectedItem="{Binding RuleType}"
                MinWidth="100"
                Text="Rule Type">
              <ComboBox.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding Converter={StaticResource TypeToNameConverter}}"/>
                </DataTemplate>
              </ComboBox.ItemTemplate>
            </ComboBox>
            <TextBlock>Description:</TextBlock>
            <TextBox Text="{Binding Description, Mode=TwoWay}" TextWrapping="Wrap"></TextBox>
          </StackPanel>
          <ContentControl Content="{Binding Rule}"/>
        </StackPanel>
      </Border>
      
    </DataTemplate>

    <DataTemplate DataType="{x:Type rules:SoundElementRule}">
      <StackPanel Orientation="Horizontal">
        <ContentControl Content="{Binding SoundElementMatcher}"/>
        <StackPanel Orientation="Vertical">
          <StackPanel Orientation="Horizontal">
            <TextBlock>Level Rule(s):</TextBlock>
            <Button Command="{Binding AddRuleCommand}">Add level rule</Button>
            <ItemsControl ItemsSource="{Binding LevelRules}">
            </ItemsControl>
          </StackPanel>
          <StackPanel Orientation="Horizontal">
            <TextBlock>Mute Rule:</TextBlock>
            <CheckBox IsChecked="{Binding MuteRuleEnabled}">
            </CheckBox>
            <ContentControl Content="{Binding MuteRule}"></ContentControl>
          </StackPanel>
        </StackPanel>
      </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type rules:LevelRule}">
      <StackPanel Orientation="Horizontal">
        <TextBlock>Operator:</TextBlock>
        <ComboBox ItemsSource="{x:Static rules:LevelRule.OperatorOptions}" SelectedValue="{Binding Operator, Mode=TwoWay}"></ComboBox>
        <TextBlock>Level:</TextBlock>
        <TextBox Text="{Binding Level}" MinWidth="50"></TextBox>
      </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type rules:MuteRule}">
      <StackPanel Orientation="Horizontal">
        <TextBlock>Expect Muted:</TextBlock>
        <CheckBox IsChecked="{Binding ExpectedMuted}"></CheckBox>
      </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type rules:MultiSoundElementMatcher}">
      <StackPanel Orientation="Vertical">
        <Border BorderThickness="1" BorderBrush="Black">
          <StackPanel Orientation="Vertical">
            <TextBlock>Included Ranges:</TextBlock>

            <ItemsControl ItemsSource="{Binding IncludedRanges}">
            </ItemsControl>

            <Button Command="{Binding AddIncludedRangeCommand}">Add included range</Button>
          </StackPanel>
        </Border>

        <Border BorderThickness="1" BorderBrush="Black">
          <StackPanel Orientation="Vertical">
            <TextBlock>Excluded Ranges:</TextBlock>

            <ItemsControl ItemsSource="{Binding ExcludedRanges}">
            </ItemsControl>

            <Button Command="{Binding AddExcludedRangeCommand}">Add excluded range</Button>
          </StackPanel>
        </Border>
        
      </StackPanel>
      
    </DataTemplate>

    <DataTemplate DataType="{x:Type rules:SoundElementRangeMatcher}">
      <Border BorderThickness="1" BorderBrush="Orange">
        <StackPanel>
          <StackPanel Orientation="Horizontal">
            <TextBlock>Channel Range:</TextBlock>
            <ContentControl Content="{Binding ChannelRange}" />
          </StackPanel>
          <StackPanel Orientation="Horizontal">
            <TextBlock>Bus Range:</TextBlock>
            <ContentControl Content="{Binding BusRange}"/>
          </StackPanel>
        </StackPanel>
      </Border>
    </DataTemplate>

    <DataTemplate DataType="{x:Type rules:SoundElementRangeToggle}">
      <StackPanel Orientation="Horizontal">
        <CheckBox IsChecked="{Binding EnableRange, Mode=TwoWay}"></CheckBox>
        
        <ContentControl Content="{Binding Range}">
          <!--<ContentControl.Style>
            <Style TargetType="ContentControl">
              <Style.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=Content}" 
                       Value="{x:Null}">
                  <Setter Property="ContentTemplate">
                    <Setter.Value>
                      <DataTemplate>
                        <StackPanel>
                          
                        </StackPanel>
                      </DataTemplate>
                    </Setter.Value>
                  </Setter>
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </ContentControl.Style>-->
        </ContentControl>

      </StackPanel>
      
      
    </DataTemplate>

    <DataTemplate DataType="{x:Type rules:SoundElementRange}">
      <StackPanel Orientation="Horizontal">
        <TextBox Text="{Binding Start}" MinWidth="50">

        </TextBox>
        <TextBlock>to</TextBlock>
        <TextBox Text="{Binding End}" MinWidth="50">

        </TextBox>
      </StackPanel>
    </DataTemplate>

    <DataTemplate DataType="{x:Type models:ISoundElement}" x:Key="StateSoundElement">
      <StackPanel Orientation="Horizontal">
        <TextBlock Text="{Binding}" Width="200"></TextBlock>
        <StackPanel Orientation="Horizontal" Width="300">
          <TextBlock Text="Level:"></TextBlock>
          <TextBlock Text="{Binding Level}"></TextBlock>
        </StackPanel>
        <StackPanel Orientation="Horizontal" Width="300">
          <TextBlock Text="Muted:"></TextBlock>
          <TextBlock Text="{Binding Muted}"></TextBlock>
        </StackPanel>
      </StackPanel>
    </DataTemplate>
  </Window.Resources>
  <DockPanel>
    <Menu DataContext="{Binding ToolBar}" DockPanel.Dock="Top">
      <MenuItem Header="_File">
        <MenuItem Header="_Open Data Folder" Command="{Binding OpenDataFolderCommand}" />
      </MenuItem>
      <MenuItem Header="_About">
        <MenuItem Header="_GitHub" Command="{Binding OpenGitHubCommand}" />
      </MenuItem>
      <MenuItem Header="_Help">
        <MenuItem Header="_Update" Command="{Binding UpdateCommand}" />
      </MenuItem>
    </Menu>
    <TabControl>
      <TabItem Header="Alerts">
        <StackPanel>
          <StackPanel Orientation="Horizontal">
            <TextBlock>
              <TextBlock.Style>
                <Style TargetType="TextBlock">
                  <Setter Property="Text" Value="Connection not initialized" />
                  <Setter Property="Foreground" Value="Red" />
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding Initialized}" Value="True">
                      <Setter Property="Text" Value="Connection initialized" />
                      <Setter Property="Foreground" Value="Green" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </TextBlock.Style>
            </TextBlock>
          </StackPanel>
          <StackPanel Orientation="Horizontal">
            <TextBlock>Received packets:</TextBlock>
            <TextBlock Text="{Binding ReceivedPacketCount}" />
          </StackPanel>
          <StackPanel Orientation="Horizontal">
            <TextBlock>Received messages:</TextBlock>
            <TextBlock Text="{Binding ReceivedMessageCount}" />
          </StackPanel>
          <ItemsControl ItemsSource="{Binding Warnings}">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Grid>
                  <StackPanel>
                    <TextBlock Margin="3,3,3,0" 
                      FontSize="15"
                      FontWeight="Bold"
                  Text="{Binding Path=Text}">
                      <TextBlock.Style>
                        <Style TargetType="TextBlock">
                          <Setter Property="Foreground" Value="Orange" />
                          <Style.Triggers>
                            <DataTrigger Binding="{Binding Level}" Value="{x:Static viewmodels:SoundBoardWarningLevel.Critical}">
                              <Setter Property="Foreground" Value="Red" />
                            </DataTrigger>
                          </Style.Triggers>
                        </Style>
                      </TextBlock.Style>
                    </TextBlock>
                  </StackPanel>
                </Grid>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </StackPanel>
      </TabItem>
      <TabItem Header="Settings" DataContext="{Binding SettingsTab}">
        <DockPanel>
          <Button Command="{Binding SaveCommand}" DockPanel.Dock="Bottom">Save</Button>
          <ScrollViewer>
            <StackPanel>
              <StackPanel Orientation="Horizontal">
                <TextBlock>Settings are saved at:</TextBlock>
                <TextBox IsReadOnly="true" Text="{x:Static settings:SettingsHelper.DataFolderPath}"></TextBox>
              </StackPanel>

              <StackPanel Orientation="Horizontal">
                <TextBlock>X32 IP Address</TextBlock>
                <TextBox Width="200" Text="{Binding IpAddress, Mode=TwoWay}" />
              </StackPanel>

              <ItemsControl ItemsSource="{Binding Rules}">
              </ItemsControl>
              <Button Command="{Binding AddRuleCommand}">Add Rule</Button>
            </StackPanel>
          </ScrollViewer>
        </DockPanel>
      </TabItem>
      <TabItem Header="State">
        <ScrollViewer>
          <StackPanel>
            <ItemsControl ItemsSource="{Binding Soundboard.Channels}"  ItemTemplate="{StaticResource StateSoundElement}" />
            <ItemsControl ItemsSource="{Binding Soundboard.Buses}"  ItemTemplate="{StaticResource StateSoundElement}" />
          </StackPanel>
        </ScrollViewer>
      </TabItem>
    </TabControl>
  </DockPanel>
  
</Window>
